openDxlApi: '0.1'
info:
  title: DXL Broker
  version: '0.1'
  description: DXL Broker
  contact:
    url: https://www.opendxl.com
solutions:
  DXL Broker:
    externalDocs:
      url: https://www.opendxl.com/filebase/index.php?file/76-opendxl-broker
    events:
    - "$ref": "#/events/~1mcafee~1event~1dxl~1brokerregistry~1brokerstate"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1brokerregistry~1brokerstatetopics"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1brokerregistry~1topicadded"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1brokerregistry~1topicremoved"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1clientregistry~1connect"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1clientregistry~1disconnect"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1dumpbrokerstate"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1dumpservicestate"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1eventsubscribernotfound"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1fabricchange"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1revocation~1list"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1svcregistry~1register"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1svcregistry~1unregister"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1tenant~1limit~1exceeded"
    - "$ref": "#/events/~1mcafee~1event~1dxl~1tenant~1limit~1reset"
events:
  "/mcafee/event/dxl/brokerregistry/brokerstate":
    description: Broker state event
    payload:
      "$ref": "#/definitions/BrokerStateEvent"
  "/mcafee/event/dxl/brokerregistry/brokerstatetopics":
    description: Topics associated with a broker state
    payload:
      type: object
      properties:
        state:
          description: State of the topics. 0 = None, 1 = Start, 2 = End.
          type: integer
          enum:
          - 0
          - 1
          - 2
        index:
          description: Index in the batch (0-based)
          type: integer
        topics:
          description: Topics
          "$ref": https://opendxl.github.io/opendxl-api-specification/v0.1/schema.json#/definitions/stringArray
    otherFields:
      changeCount:
        description: Change count related to topics
      startTime:
        description: Broker start time (as seconds from epoch)
  "/mcafee/event/dxl/brokerregistry/topicadded":
    description: 'Broker topic: add event'
    payload:
      type: object
      properties:
        topic:
          description: Topic that has been added
          type: string
      example:
        topic: "/isecg/sample/basicservice"
    otherFields:
      "$ref": "#/definitions/BrokerTopicOtherFields"
  "/mcafee/event/dxl/brokerregistry/topicremoved":
    description: 'Broker topic: remove event'
    payload:
      type: object
      properties:
        topic:
          description: Topic that has been removed
          type: string
      example:
        topic: "/isecg/sample/basicservice"
    otherFields:
      "$ref": "#/definitions/BrokerTopicOtherFields"
  "/mcafee/event/dxl/clientregistry/connect":
    description: 'Client registry: connect event'
    payload:
      type: object
      properties:
        clientGuid:
          description: Client identifier
          type: string
      example:
        clientGuid: "{12345678-abcd-1234-abcd-123456789abc}"
  "/mcafee/event/dxl/clientregistry/disconnect":
    description: 'Client registry: disconnect event'
    payload:
      type: object
      properties:
        clientGuid:
          description: Client identifier
          type: string
      example:
        clientGuid: "{e834986f-4e14-44d9-979a-acc35512c894}"
  "/mcafee/event/dxl/dumpbrokerstate":
    description: Dump broker state event
  "/mcafee/event/dxl/dumpservicestate":
    description: Dump services state event
  "/mcafee/event/dxl/eventsubscribernotfound":
    description: Subscriber not found event
    payload:
      type: object
      properties:
        topic:
          description: Topic
          type: string
  "/mcafee/event/dxl/fabricchange":
    description: Fabric change event
  "/mcafee/event/dxl/revocation/list":
    description: Revocation list event
    payload:
      description: List of certificate data (1 certificate per line)
      type: string
  "/mcafee/event/dxl/svcregistry/register":
    description: 'Service registry: register event'
    payload:
      "$ref": "#/definitions/ServiceRegistryRegisterEvent"
      example:
        brokerGuid: c75cb962-6928-4894-bf83-d6ce9ad36306
        certificates:
        - 7c357987eabc9dd88481b35297f9e425cd433799
        - 84841b6fd81483746dc7390e8e44dfa4c86e1ba8
        clientGuid: "{e834986f-4e14-44d9-979a-acc35512c894}"
        managed: false
        metaData: {}
        registrationTime: 1539623701
        requestChannels:
        - "/isecg/sample/basicservice"
        serviceGuid: "{3614fef1-635d-456d-82ce-57c165e0b326}"
        serviceType: myService
        ttlMins: 60
  "/mcafee/event/dxl/svcregistry/unregister":
    description: 'Service registry: unregister event'
    payload:
      type: object
      properties:
        serviceGuid:
          type: string
      example:
        serviceGuid: "{3614fef1-635d-456d-82ce-57c165e0b326}"
  "/mcafee/event/dxl/tenant/limit/exceeded":
    description: Tenant exceeds byte limit event
    payload:
      type: object
      properties:
        clientTenantGuid:
          description: Identifier of the tenant that exceeded the limit
          type: string
  "/mcafee/event/dxl/tenant/limit/reset":
    description: Tenant limit reset event
requests:
  "/mcafee/service/dxl/broker/testmode/disable":
    description: Disable the test mode
    response:
      payload:
        type: string
        example: ''
  "/mcafee/service/dxl/broker/testmode/enable":
    description: Enable the test mode
    response:
      payload:
        type: string
        example: ''
  "/mcafee/service/dxl/broker/health":
    description: Broker health request
    response:
      payload:
        type: object
        properties:
          connectedClients:
            description: Number of connected clients
            type: integer
          incomingMessages:
            description: Number of incoming messages
            type: number
            format: double
          ipe:
            description: IPE health
            type: object
            properties:
              fabrics:
                "$ref": "#/definitions/IpeHealthPayload"
              patterns:
                "$ref": "#/definitions/IpeHealthPayload"
              plugins:
                "$ref": "#/definitions/IpeHealthPayload"
              properties:
                "$ref": "#/definitions/IpeHealthPayloadProperties"
          localServiceCounter:
            description: Count of local services registered with the broker
            type: integer
          outgoingMessages:
            description: Number of outgoing messages
            type: number
            format: double
          startTime:
            description: Start time of the broker (as seconds from epoch)
            type: integer
        example:
          connectedClients: 5
          incomingMessages: 0.01666666753590107
          ipe:
            fabrics: {}
            patterns: {}
            plugins:
              epo:
                displayName: epo
                properties: {}
            properties: {}
          localServiceCounter: 3
          outgoingMessages: 0.01666666753590107
          startTime: 1537401471
  "/mcafee/service/dxl/broker/subs":
    description: Broker subscriptions
    payload:
      type: object
      required:
      - topic
      properties:
        topic:
          description: Subscription topic
          type: string
      example:
        topic: "/my/test/topic"
    response:
      payload:
        type: object
        properties:
          count:
            description: Broker subscription count
            type: integer
        example:
          count: 0
  "/mcafee/service/dxl/brokerregistry/query":
    description: 'Broker registry: query'
    payload:
      type: object
      properties:
        brokerGuid:
          description: Broker GUID
          type: string
      example:
        brokerGuid: "{0f41d474-95d7-11e8-1a8f-00155d842e2d}"
    response:
      payload:
        type: object
        properties:
          brokers:
            additionalProperties:
              "$ref": "#/definitions/BrokerStateEvent"
        example:
          brokers:
            "{0f41d474-95d7-11e8-1a8f-00155d842e2d}":
              bridgeChildren: []
              bridges: []
              connectionLimit: 50000
              epoName: MY-EPO1
              guid: "{0f41d474-95d7-11e8-1a8f-00155d842e2d}"
              hostname: my-broker1
              policyHostname: my-broker1
              policyHub: ''
              policyIpAddress: 10.0.0.1
              policyPort: 8883
              port: 8883
              startTime: 1537401471
              topicRouting: true
              ttlMins: 60
              version: 5.0.0.289
  "/mcafee/service/dxl/brokerregistry/topicquery":
    description: 'Broker topic: query'
    payload:
      type: object
      properties:
        brokerGuid:
          type: string
        topics:
          "$ref": https://opendxl.github.io/opendxl-api-specification/v0.1/schema.json#/definitions/stringArray
      example:
        brokerGuid: "{0f41d474-95d7-11e8-1a8f-00155d842e2d}"
        topics:
        - "/my/topic/1"
        - "/my/topic/2"
    response:
      payload:
        type: object
        properties:
          count:
            description: Broker topic count
            type: integer
          exists:
            description: Indicator for if broker has the request topics
            type: boolean
        example:
          count: 22
          exists: true
  "/mcafee/service/dxl/clientregistry/query":
    description: 'Client registry: query'
    payload:
      type: object
      required:
      - clientGuid
      properties:
        clientGuid:
          type: string
      example:
        clientGuid: "{ede89c16-dd10-404d-aad1-ea0e63a382fb}"
    response:
      description: If no client is connected for the supplied clientGuid, no response
        is returned. If a client is connected for the supplied clientGuid, an empty
        response is returned.
      payload:
        type: string
        example: ''
  "/mcafee/service/dxl/svcregistry/query":
    description: 'Service registry: query'
    payload:
      type: object
      properties:
        serviceGuid:
          description: Service GUID
          type: string
        serviceType:
          description: Service type
          type: string
      example:
        serviceType: "/my/service/service1"
    response:
      payload:
        type: object
        properties:
          services:
            type: object
            additionalProperties:
              allOf:
              - "$ref": "#/definitions/ServiceRegistryRegisterEvent"
              properties:
                local:
                  description: Whether the service is local to this broker
                  type: boolean
                unauthorizedChannels:
                  description: Unauthorized channels for service
                  "$ref": https://opendxl.github.io/opendxl-api-specification/v0.1/schema.json#/definitions/stringArray
        example:
          services:
            "{92240a29-2c76-41b2-a3dd-89ef6ff1dcf1}":
              brokerGuid: c75cb962-6928-4894-bf83-d6ce9ad36306
              certificates:
              - 7c357987eabc9dd88481b35297f9e425cd433799
              - 84841b6fd81483746dc7390e8e44dfa4c86e1ba8
              clientGuid: "{7760a256-68f0-4075-bf6f-52d603367642}"
              local: true
              managed: false
              metaData: {}
              registrationTime: 1539636395
              requestChannels:
              - "/my/service/service1/host_lookup"
              serviceGuid: "{92240a29-2c76-41b2-a3dd-89ef6ff1dcf1}"
              serviceType: "/my/service/service1"
              ttlMins: 60
              unauthorizedChannels: []
  "/mcafee/service/dxl/svcregistry/register":
    description: 'Service registry: register'
    payload:
      "$ref": "#/definitions/ServiceRegistryRegisterEvent"
      example:
        clientGuid: "{e834986f-4e14-44d9-979a-acc35512c894}"
        metaData: {}
        registrationTime: 1539623701
        requestChannels:
        - "/isecg/sample/basicservice"
        serviceGuid: "{3614fef1-635d-456d-82ce-57c165e0b326}"
        serviceType: myService
        ttlMins: 60
    response:
      payload:
        type: string
        example: ''
  "/mcafee/service/dxl/svcregistry/unregister":
    description: 'Service registry: unregister'
    payload:
      type: object
      properties:
        serviceGuid:
          description: Service GUID
          type: string
      example:
        serviceGuid: "{3614fef1-635d-456d-82ce-57c165e0b326}"
    response:
      payload:
        type: string
        example: ''
definitions:
  BrokerStateEvent:
    type: object
    properties:
      bridgeChildren:
        description: Broker's child connections
        "$ref": https://opendxl.github.io/opendxl-api-specification/v0.1/schema.json#/definitions/stringArray
      bridges:
        description: Broker's connections
        "$ref": https://opendxl.github.io/opendxl-api-specification/v0.1/schema.json#/definitions/stringArray
      connectionLimit:
        description: Broker connection limit
        type: integer
      epoName:
        description: Managing ePO name
        type: string
      guid:
        description: Broker GUID
        type: string
      hostname:
        description: Broker hostname
        type: string
      policyHostname:
        description: Broker host name (via policy)
        type: string
      policyHub:
        description: Broker hub name (via policy)
        type: string
      policyIpAddress:
        description: Broker IP address (via policy)
        type: string
      policyPort:
        description: Broker port (via policy)
        type: integer
      port:
        description: Broker port
        type: integer
      startTime:
        description: Broker start time (as seconds from epoch)
        type: integer
      topicRouting:
        description: Whether topic routing is enabled
        type: boolean
      ttlMins:
        description: Broker Time to Live (in minutes)
        type: integer
      version:
        description: Broker version
        type: string
  IpeHealthPayloadProperties:
    type: object
    additionalProperties:
      properties:
        displayName:
          type: string
        value:
          type: string
        type:
          type: string
  IpeHealthPayload:
    type: object
    additionalProperties:
      properties:
        displayName:
          type: string
        properties:
          "$ref": "#/definitions/IpeHealthPayloadProperties"
  ServiceRegistryRegisterEvent:
    type: object
    properties:
      brokerGuid:
        description: Broker GUID
        type: string
      certificates:
        description: Service metadata
        "$ref": https://opendxl.github.io/opendxl-api-specification/v0.1/schema.json#/definitions/stringArray
      clientGuid:
        description: Client GUID
        type: string
      clientInstanceGuid:
        description: Client instance GUID
        type: string
      clientTenantGuid:
        description: Tenant GUID of the client that registered the service
        type: string
      metaData:
        description: Service metadata
        type: object
        additionalProperties:
          type: string
      managed:
        description: Whether the service is associated with a managed client
        type: boolean
      requestChannels:
        description: Service request channels
        "$ref": https://opendxl.github.io/opendxl-api-specification/v0.1/schema.json#/definitions/stringArray
      registrationTime:
        description: Registration time (as seconds from epoch)
        type: integer
      serviceType:
        description: Service type
        type: string
      serviceGuid:
        description: Service GUID
        type: string
      targetTenantGuids:
        description: Target tenant GUIDs
        "$ref": https://opendxl.github.io/opendxl-api-specification/v0.1/schema.json#/definitions/stringArray
      ttlMins:
        description: Service Time to Live (in minutes)
        type: integer
